<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:flowable="http://flowable.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:design="http://flowable.org/design" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://flowable.org/test" design:palette="flowable-process-palette">
    <process id="subProcessErrorHandling" name="subProcessErrorHandling" isExecutable="true" flowable:candidateStarterGroups="flowableUser">
        <startEvent id="startEvent1" />
        <subProcess id="expandedSubProcess1" name="Subprocess">
            <scriptTask id="subProcessTask" name="Suprocess Script task" scriptFormat="groovy" flowable:autoStoreVariables="false">
                <extensionElements>
                    <flowable:executionListener type="script" event="start">
                        <flowable:script language="groovy">
                            <![CDATA[
                            if(execution.getVariable('throwErrorStartListener') != null)
                                throw new org.flowable.engine.delegate.BpmnError(execution.getVariable('throwErrorStartListener'));
                             else
                                 execution.setVariable('startListener', 'executed');
                            ]]>
                    </flowable:script>
                    </flowable:executionListener>
                    <flowable:executionListener type="script" event="end">
                        <flowable:script language="groovy">
                            <![CDATA[
                            if(execution.getVariable('throwErrorEndListener') != null)
                                throw new org.flowable.engine.delegate.BpmnError(execution.getVariable('throwErrorEndListener'));
                             else
                                 execution.setVariable('endListener', 'executed');
                            ]]>
                        </flowable:script>
                    </flowable:executionListener>
                </extensionElements>
                <script><![CDATA[execution.setVariable('_script_task', 'executed');]]></script>
            </scriptTask>
            <startEvent id="startNoneEvent2" />
            <sequenceFlow id="sequenceFlow6" sourceRef="startNoneEvent2" targetRef="subProcessTask" />
        </subProcess>
        <subProcess id="errorHandlingSubProcess" name="subProcess" triggeredByEvent="true">
            <startEvent id="startErrorEvent1" isInterrupting="true">
                <errorEventDefinition></errorEventDefinition>
            </startEvent>
            <scriptTask id="handleError" name="Handle Error" scriptFormat="groovy" flowable:autoStoreVariables="false">
                <script><![CDATA[execution.setVariable('error_handled', 'true');]]></script>
            </scriptTask>
            <endEvent id="endHandleError" />
            <sequenceFlow id="sequenceFlow7" sourceRef="startErrorEvent1" targetRef="handleError" />
            <sequenceFlow id="sequenceFlow8" sourceRef="handleError" targetRef="endHandleError" />
        </subProcess>
        <scriptTask id="scriptTask2" name="Script task" scriptFormat="groovy" flowable:autoStoreVariables="false">
            <script><![CDATA[execution.setVariable('defaultTask', 'executed');]]></script>
        </scriptTask>
        <exclusiveGateway id="exclusive_Databased_Gateway1" default="sequenceFlow4" />
        <sequenceFlow id="sequenceFlow2" sourceRef="startEvent1" targetRef="exclusive_Databased_Gateway1" />
        <sequenceFlow id="sequenceFlow3" sourceRef="exclusive_Databased_Gateway1" targetRef="expandedSubProcess1">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${direction eq 'subprocess'}]]></conditionExpression>
        </sequenceFlow>
        <sequenceFlow id="sequenceFlow4" sourceRef="exclusive_Databased_Gateway1" targetRef="scriptTask2" />
        <endEvent id="endEventNormal" />
        <sequenceFlow id="sequenceFlow5" sourceRef="scriptTask2" targetRef="endEventNormal" />
        <sequenceFlow id="sequenceFlow9" sourceRef="expandedSubProcess1" targetRef="endEventNormal" />
    </process>
</definitions>