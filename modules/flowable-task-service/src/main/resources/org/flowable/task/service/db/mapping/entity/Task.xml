<?xml version="1.0" encoding="UTF-8" ?>

<!--
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~       http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->


<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.flowable.task.service.impl.persistence.entity.TaskEntityImpl">

  <!-- TASK INSERT -->

  <insert id="insertTask" parameterType="org.flowable.task.service.impl.persistence.entity.TaskEntityImpl">
    insert into ${prefix}ACT_RU_TASK (ID_, REV_, NAME_, PARENT_TASK_ID_, DESCRIPTION_, PRIORITY_, OWNER_, ASSIGNEE_, DELEGATION_,
                      EXECUTION_ID_, PROC_INST_ID_, PROC_DEF_ID_, TASK_DEF_ID_, SCOPE_ID_, SUB_SCOPE_ID_, SCOPE_TYPE_, SCOPE_DEFINITION_ID_,
                      PROPAGATED_STAGE_INST_ID_, TASK_DEF_KEY_, STATE_, CREATE_TIME_, IN_PROGRESS_TIME_, IN_PROGRESS_STARTED_BY_, CLAIM_TIME_, CLAIMED_BY_, 
                      SUSPENDED_TIME_, SUSPENDED_BY_, IN_PROGRESS_DUE_DATE_, DUE_DATE_, CATEGORY_, SUSPENSION_STATE_, TENANT_ID_, FORM_KEY_,
                      IS_COUNT_ENABLED_, VAR_COUNT_, ID_LINK_COUNT_, SUB_TASK_COUNT_)
    values (#{id, jdbcType=NVARCHAR},
            1, #{name, jdbcType=NVARCHAR},
            #{parentTaskId, jdbcType=NVARCHAR},
            #{description, jdbcType=NVARCHAR},
            #{priority, jdbcType=INTEGER},
            #{owner, jdbcType=NVARCHAR},
            #{assignee, jdbcType=NVARCHAR},
            #{delegationStateString, jdbcType=NVARCHAR},
            #{executionId, jdbcType=NVARCHAR},
            #{processInstanceId, jdbcType=NVARCHAR},
            #{processDefinitionId, jdbcType=NVARCHAR},
            #{taskDefinitionId, jdbcType=NVARCHAR},
            #{scopeId, jdbcType=NVARCHAR},
            #{subScopeId, jdbcType=NVARCHAR},
            #{scopeType, jdbcType=NVARCHAR},
            #{scopeDefinitionId, jdbcType=NVARCHAR},
            #{propagatedStageInstanceId, jdbcType=NVARCHAR},
            #{taskDefinitionKey, jdbcType=NVARCHAR},
            #{state, jdbcType=NVARCHAR},
            #{createTime, jdbcType=TIMESTAMP},
            #{inProgressStartTime, jdbcType=TIMESTAMP},
            #{inProgressStartedBy, jdbcType=NVARCHAR},
            #{claimTime, jdbcType=TIMESTAMP},
            #{claimedBy, jdbcType=NVARCHAR},
            #{suspendedTime, jdbcType=TIMESTAMP},
            #{suspendedBy, jdbcType=NVARCHAR},
            #{inProgressStartDueDate, jdbcType=TIMESTAMP},
            #{dueDate, jdbcType=TIMESTAMP},
            #{category, jdbcType=NVARCHAR},
            #{suspensionState, jdbcType=INTEGER},
            #{tenantId, jdbcType=NVARCHAR},
            #{formKey, jdbcType=NVARCHAR},
            #{isCountEnabled, jdbcType=BOOLEAN},
            #{variableCount, jdbcType=INTEGER},
            #{identityLinkCount, jdbcType=INTEGER},
            #{subTaskCount, jdbcType=INTEGER}
           )
  </insert>

  <insert id="bulkInsertTask" parameterType="java.util.List">
    INSERT INTO ${prefix}ACT_RU_TASK (ID_, REV_, NAME_, PARENT_TASK_ID_, DESCRIPTION_, PRIORITY_, OWNER_, ASSIGNEE_, DELEGATION_,
        EXECUTION_ID_, PROC_INST_ID_, PROC_DEF_ID_, TASK_DEF_ID_, SCOPE_ID_, SUB_SCOPE_ID_, SCOPE_TYPE_, SCOPE_DEFINITION_ID_, PROPAGATED_STAGE_INST_ID_,
        TASK_DEF_KEY_, STATE_, CREATE_TIME_, IN_PROGRESS_TIME_, IN_PROGRESS_STARTED_BY_, CLAIM_TIME_, CLAIMED_BY_, SUSPENDED_TIME_, SUSPENDED_BY_, 
        IN_PROGRESS_DUE_DATE_, DUE_DATE_, CATEGORY_, SUSPENSION_STATE_, TENANT_ID_, FORM_KEY_,
        IS_COUNT_ENABLED_, VAR_COUNT_, ID_LINK_COUNT_, SUB_TASK_COUNT_)
    VALUES
      <foreach collection="list" item="task" index="index" separator=",">
        (#{task.id, jdbcType=NVARCHAR},
         1, #{task.name, jdbcType=NVARCHAR},
         #{task.parentTaskId, jdbcType=NVARCHAR},
         #{task.description, jdbcType=NVARCHAR},
         #{task.priority, jdbcType=INTEGER},
         #{task.owner, jdbcType=NVARCHAR},
         #{task.assignee, jdbcType=NVARCHAR},
         #{task.delegationStateString, jdbcType=NVARCHAR},
         #{task.executionId, jdbcType=NVARCHAR},
         #{task.processInstanceId, jdbcType=NVARCHAR},
         #{task.processDefinitionId, jdbcType=NVARCHAR},
         #{task.taskDefinitionId, jdbcType=NVARCHAR},
         #{task.scopeId, jdbcType=NVARCHAR},
         #{task.subScopeId, jdbcType=NVARCHAR},
         #{task.scopeType, jdbcType=NVARCHAR},
         #{task.scopeDefinitionId, jdbcType=NVARCHAR},
         #{task.propagatedStageInstanceId, jdbcType=NVARCHAR},
         #{task.taskDefinitionKey, jdbcType=NVARCHAR},
         #{task.state, jdbcType=NVARCHAR},
         #{task.createTime, jdbcType=TIMESTAMP},
         #{task.inProgressStartTime, jdbcType=TIMESTAMP},
         #{task.inProgressStartedBy, jdbcType=NVARCHAR},
         #{task.claimTime, jdbcType=TIMESTAMP},
         #{task.claimedBy, jdbcType=NVARCHAR},
         #{task.suspendedTime, jdbcType=TIMESTAMP},
         #{task.suspendedBy, jdbcType=NVARCHAR},
         #{task.inProgressStartDueDate, jdbcType=TIMESTAMP},
         #{task.dueDate, jdbcType=TIMESTAMP},
         #{task.category, jdbcType=NVARCHAR},
         #{task.suspensionState, jdbcType=INTEGER},
         #{task.tenantId, jdbcType=NVARCHAR},
         #{task.formKey, jdbcType=NVARCHAR},
         #{task.isCountEnabled, jdbcType=BOOLEAN},
         #{task.variableCount, jdbcType=INTEGER},
         #{task.identityLinkCount, jdbcType=INTEGER},
         #{task.subTaskCount, jdbcType=INTEGER}
         )
    </foreach>
  </insert>

  <insert id="bulkInsertTask" databaseId="oracle" parameterType="java.util.List">
    INSERT ALL
      <foreach collection="list" item="task" index="index">
        INTO ${prefix}ACT_RU_TASK (ID_, REV_, NAME_, PARENT_TASK_ID_, DESCRIPTION_, PRIORITY_, OWNER_, ASSIGNEE_, DELEGATION_,
              EXECUTION_ID_, PROC_INST_ID_, PROC_DEF_ID_, TASK_DEF_ID_, SCOPE_ID_, SUB_SCOPE_ID_, SCOPE_TYPE_, SCOPE_DEFINITION_ID_, PROPAGATED_STAGE_INST_ID_, TASK_DEF_KEY_,
              STATE_, CREATE_TIME_, IN_PROGRESS_TIME_, IN_PROGRESS_STARTED_BY_, CLAIM_TIME_, CLAIMED_BY_, SUSPENDED_TIME_, SUSPENDED_BY_, 
              IN_PROGRESS_DUE_DATE_, DUE_DATE_, CATEGORY_, SUSPENSION_STATE_, TENANT_ID_, FORM_KEY_,
              IS_COUNT_ENABLED_, VAR_COUNT_, ID_LINK_COUNT_, SUB_TASK_COUNT_) VALUES
        (#{task.id, jdbcType=NVARCHAR},
         1, #{task.name, jdbcType=NVARCHAR},
         #{task.parentTaskId, jdbcType=NVARCHAR},
         #{task.description, jdbcType=NVARCHAR},
         #{task.priority, jdbcType=INTEGER},
         #{task.owner, jdbcType=NVARCHAR},
         #{task.assignee, jdbcType=NVARCHAR},
         #{task.delegationStateString, jdbcType=NVARCHAR},
         #{task.executionId, jdbcType=NVARCHAR},
         #{task.processInstanceId, jdbcType=NVARCHAR},
         #{task.processDefinitionId, jdbcType=NVARCHAR},
         #{task.taskDefinitionId, jdbcType=NVARCHAR},
         #{task.scopeId, jdbcType=NVARCHAR},
         #{task.subScopeId, jdbcType=NVARCHAR},
         #{task.scopeType, jdbcType=NVARCHAR},
         #{task.scopeDefinitionId, jdbcType=NVARCHAR},
         #{task.propagatedStageInstanceId, jdbcType=NVARCHAR},
         #{task.taskDefinitionKey, jdbcType=NVARCHAR},
         #{task.state, jdbcType=NVARCHAR},
         #{task.createTime, jdbcType=TIMESTAMP},
         #{task.inProgressStartTime, jdbcType=TIMESTAMP},
         #{task.inProgressStartedBy, jdbcType=NVARCHAR},
         #{task.claimTime, jdbcType=TIMESTAMP},
         #{task.claimedBy, jdbcType=NVARCHAR},
         #{task.suspendedTime, jdbcType=TIMESTAMP},
         #{task.suspendedBy, jdbcType=NVARCHAR},
         #{task.inProgressStartDueDate, jdbcType=TIMESTAMP},
         #{task.dueDate, jdbcType=TIMESTAMP},
         #{task.category, jdbcType=NVARCHAR},
         #{task.suspensionState, jdbcType=INTEGER},
         #{task.tenantId, jdbcType=NVARCHAR},
         #{task.formKey, jdbcType=NVARCHAR},
         #{task.isCountEnabled, jdbcType=BOOLEAN},
         #{task.variableCount, jdbcType=INTEGER},
         #{task.identityLinkCount, jdbcType=INTEGER},
         #{task.subTaskCount, jdbcType=INTEGER}
         )
    </foreach>
    SELECT * FROM dual
  </insert>

  <!-- TASK UPDATE -->

  <update id="updateTask" parameterType="org.flowable.task.service.impl.persistence.entity.TaskEntityImpl">
    update ${prefix}ACT_RU_TASK
    <set>
      REV_ = #{revisionNext, jdbcType=INTEGER},
      <if test="originalPersistentState.name != name">
          NAME_ = #{name, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.parentTaskId != parentTaskId">
          PARENT_TASK_ID_ = #{parentTaskId, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.priority != priority">
          PRIORITY_ = #{priority, jdbcType=INTEGER},
      </if>
      <if test="originalPersistentState.createTime != createTime">
          CREATE_TIME_ = #{createTime, jdbcType=TIMESTAMP},
      </if>
      <if test="originalPersistentState.inProgressStartTime != inProgressStartTime">
          IN_PROGRESS_TIME_ = #{inProgressStartTime, jdbcType=TIMESTAMP},
      </if>
      <if test="originalPersistentState.inProgressStartedBy != inProgressStartedBy">
          IN_PROGRESS_STARTED_BY_ = #{inProgressStartedBy, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.claimTime != claimTime">
          CLAIM_TIME_ = #{claimTime, jdbcType=TIMESTAMP},
      </if>
      <if test="originalPersistentState.claimedBy != claimedBy">
          CLAIMED_BY_ = #{claimedBy, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.suspendedTime != suspendedTime">
          SUSPENDED_TIME_ = #{suspendedTime, jdbcType=TIMESTAMP},
      </if>
      <if test="originalPersistentState.suspendedBy != suspendedBy">
          SUSPENDED_BY_ = #{suspendedBy, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.owner != owner">
          OWNER_ = #{owner, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.assignee != assignee">
          ASSIGNEE_ = #{assignee, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.delegationStateString != delegationStateString">
          DELEGATION_ = #{delegationStateString, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.executionId != executionId">
          EXECUTION_ID_ = #{executionId, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.processDefinitionId != processDefinitionId">
          PROC_DEF_ID_ = #{processDefinitionId, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.taskDefinitionId != taskDefinitionId">
          TASK_DEF_ID_ = #{taskDefinitionId, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.taskDefinitionKey != taskDefinitionKey">
          TASK_DEF_KEY_ = #{taskDefinitionKey, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.state != state">
          STATE_ = #{state, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.scopeId != scopeId">
          SCOPE_ID_ = #{scopeId, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.subScopeId != subScopeId">
          SUB_SCOPE_ID_ = #{subScopeId, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.scopeType != scopeType">
          SCOPE_TYPE_ = #{scopeType, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.scopeDefinitionId != scopeDefinitionId">
          SCOPE_DEFINITION_ID_ = #{scopeDefinitionId, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.propagatedStageInstanceId != propagatedStageInstanceId">
          PROPAGATED_STAGE_INST_ID_ = #{propagatedStageInstanceId, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.description != description">
          DESCRIPTION_ = #{description, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.inProgressStartDueDate != inProgressStartDueDate">
          IN_PROGRESS_DUE_DATE_ = #{inProgressStartDueDate, jdbcType=TIMESTAMP},
      </if>
      <if test="originalPersistentState.dueDate != dueDate">
          DUE_DATE_ = #{dueDate, jdbcType=TIMESTAMP},
      </if>
      <if test="originalPersistentState.category != category">
          CATEGORY_ = #{category, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.suspensionState != suspensionState">
          SUSPENSION_STATE_ = #{suspensionState, jdbcType=INTEGER},
      </if>
      <if test="originalPersistentState.formKey != formKey">
          FORM_KEY_ = #{formKey, jdbcType=NVARCHAR},
      </if>
      <if test="originalPersistentState.isCountEnabled != isCountEnabled">
          IS_COUNT_ENABLED_ = #{isCountEnabled, jdbcType=BOOLEAN},
      </if>
      <if test="originalPersistentState.variableCount != variableCount">
          VAR_COUNT_ = #{variableCount, jdbcType=INTEGER},
      </if>
      <if test="originalPersistentState.identityLinkCount != identityLinkCount">
          ID_LINK_COUNT_ = #{identityLinkCount, jdbcType=INTEGER},
      </if>
      <if test="originalPersistentState.subTaskCount != subTaskCount">
          SUB_TASK_COUNT_ = #{subTaskCount, jdbcType=INTEGER},
      </if>
    </set>
    where ID_= #{id, jdbcType=NVARCHAR}
      and REV_ = #{revision, jdbcType=INTEGER}
  </update>

  <update id="updateTaskTenantIdForDeployment" parameterType="java.util.Map">
    update ${prefix}ACT_RU_TASK set
      TENANT_ID_ = #{tenantId, jdbcType=NVARCHAR}
    where
      ID_ in (
        SELECT T.ID_ from ${prefix}ACT_RU_TASK T
        inner join ${prefix}ACT_RE_PROCDEF P on T.PROC_DEF_ID_  = P.ID_
        inner join ${prefix}ACT_RE_DEPLOYMENT D on P.DEPLOYMENT_ID_ = D.ID_
        where D.ID_ = #{deploymentId, jdbcType=NVARCHAR}
      )
  </update>

    <!-- See http://stackoverflow.com/questions/4429319/you-cant-specify-target-table-for-update-in-from-clause
       Tested this on MySQL 5.6: does NOT use a temporary table (so good, performance0 -->
  <update id="updateTaskTenantIdForDeployment" databaseId="mysql" parameterType="java.util.Map">
    update ${prefix}ACT_RU_TASK set
      TENANT_ID_ = #{tenantId, jdbcType=NVARCHAR}
    where
      ID_ in (

          SELECT tempTask.tempId
          FROM (
                SELECT T.ID_ as tempId
                FROM  ${prefix}ACT_RU_TASK T
                inner join ${prefix}ACT_RE_PROCDEF P on T.PROC_DEF_ID_  = P.ID_
                inner join ${prefix}ACT_RE_DEPLOYMENT D on P.DEPLOYMENT_ID_ = D.ID_
                where D.ID_ = #{deploymentId, jdbcType=NVARCHAR}

        ) AS tempTask

    )
  </update>


  <update id="updateTaskRelatedEntityCountEnabled" parameterType="boolean">
    update ${prefix}ACT_RU_TASK
    set IS_COUNT_ENABLED_ = #{parameter, jdbcType=BOOLEAN}
  </update>

  <!-- TASK DELETE -->
  <delete id="deleteTask" parameterType="org.flowable.task.service.impl.persistence.entity.TaskEntityImpl">
    delete from ${prefix}ACT_RU_TASK where ID_ = #{id, jdbcType=NVARCHAR} and REV_ = #{revision, jdbcType=INTEGER}
  </delete>

  <delete id="deleteTasksByExecutionId" parameterType="string">
    delete from ${prefix}ACT_RU_TASK where EXECUTION_ID_ = #{id, jdbcType=NVARCHAR}
  </delete>

  <delete id="bulkDeleteTask" parameterType="java.util.Collection">
    delete from ${prefix}ACT_RU_TASK where
    <foreach item="task" collection="list" index="index" separator=" or ">
        ID_ = #{task.id, jdbcType=NVARCHAR}
    </foreach>
  </delete>

  <!-- TASK RESULTMAP -->

  <resultMap id="taskResultMap" type="org.flowable.task.service.impl.persistence.entity.TaskEntityImpl">
    <id property="id" column="ID_" jdbcType="NVARCHAR"/>
    <result property="revision" column="REV_" jdbcType="INTEGER"/>
    <result property="name" column="NAME_" jdbcType="NVARCHAR"/>
    <result property="parentTaskId" column="PARENT_TASK_ID_" jdbcType="NVARCHAR"/>
    <result property="description" column="DESCRIPTION_" jdbcType="NVARCHAR"/>
    <result property="priority" column="PRIORITY_" jdbcType="INTEGER"/>
    <result property="createTime" column="CREATE_TIME_" jdbcType="TIMESTAMP" />
    <result property="inProgressStartTime" column="IN_PROGRESS_TIME_" jdbcType="TIMESTAMP" />
    <result property="inProgressStartedBy" column="IN_PROGRESS_STARTED_BY_" jdbcType="NVARCHAR"/>
    <result property="claimTime" column="CLAIM_TIME_" jdbcType="TIMESTAMP" />
    <result property="claimedBy" column="CLAIMED_BY_" jdbcType="NVARCHAR"/>
    <result property="suspendedTime" column="SUSPENDED_TIME_" jdbcType="TIMESTAMP" />
    <result property="suspendedBy" column="SUSPENDED_BY_" jdbcType="NVARCHAR"/>
    <result property="owner" column="OWNER_" jdbcType="NVARCHAR"/>
    <result property="assignee" column="ASSIGNEE_" jdbcType="NVARCHAR"/>
    <result property="delegationStateString" column="DELEGATION_" jdbcType="NVARCHAR"/>
    <result property="executionId" column="EXECUTION_ID_" jdbcType="NVARCHAR" />
    <result property="processInstanceId" column="PROC_INST_ID_" jdbcType="NVARCHAR" />
    <result property="processDefinitionId" column="PROC_DEF_ID_" jdbcType="NVARCHAR"/>
    <result property="taskDefinitionId" column="TASK_DEF_ID_" jdbcType="NVARCHAR"/>
    <result property="scopeId" column="SCOPE_ID_" jdbcType="NVARCHAR"/>
    <result property="subScopeId" column="SUB_SCOPE_ID_" jdbcType="NVARCHAR"/>
    <result property="scopeType" column="SCOPE_TYPE_" jdbcType="NVARCHAR"/>
    <result property="scopeDefinitionId" column="SCOPE_DEFINITION_ID_" jdbcType="NVARCHAR"/>
    <result property="propagatedStageInstanceId" column="PROPAGATED_STAGE_INST_ID_" jdbcType="NVARCHAR"/>
    <result property="taskDefinitionKey" column="TASK_DEF_KEY_" jdbcType="NVARCHAR"/>
    <result property="state" column="STATE_" jdbcType="NVARCHAR"/>
    <result property="inProgressStartDueDate" column="IN_PROGRESS_DUE_DATE_" jdbcType="TIMESTAMP"/>
    <result property="dueDate" column="DUE_DATE_" jdbcType="TIMESTAMP"/>
    <result property="category" column="CATEGORY_" jdbcType="NVARCHAR" />
    <result property="suspensionState" column="SUSPENSION_STATE_" jdbcType="INTEGER" />
    <result property="tenantId" column="TENANT_ID_" jdbcType="NVARCHAR" />
    <result property="formKey" column="FORM_KEY_" jdbcType="NVARCHAR" />
    <result property="isCountEnabled" column="IS_COUNT_ENABLED_" jdbcType="BOOLEAN" />
    <result property="variableCount" column="VAR_COUNT_" jdbcType="INTEGER" />
    <result property="identityLinkCount" column="ID_LINK_COUNT_" jdbcType="INTEGER" />
    <result property="subTaskCount" column="SUB_TASK_COUNT_" jdbcType="INTEGER" />
  </resultMap>

  <resultMap id="taskAndRelatedEntitiesResultMap" type="org.flowable.task.service.impl.persistence.entity.TaskEntityImpl">
    <id property="id" column="ID_" jdbcType="NVARCHAR"/>
    <result property="revision" column="REV_" jdbcType="INTEGER"/>
    <result property="name" column="NAME_" jdbcType="NVARCHAR"/>
    <result property="parentTaskId" column="PARENT_TASK_ID_" jdbcType="NVARCHAR"/>
    <result property="description" column="DESCRIPTION_" jdbcType="NVARCHAR"/>
    <result property="priority" column="PRIORITY_" jdbcType="INTEGER"/>
    <result property="createTime" column="CREATE_TIME_" jdbcType="TIMESTAMP" />
    <result property="inProgressStartTime" column="IN_PROGRESS_TIME_" jdbcType="TIMESTAMP" />
    <result property="inProgressStartedBy" column="IN_PROGRESS_STARTED_BY_" jdbcType="NVARCHAR"/>
    <result property="claimTime" column="CLAIM_TIME_" jdbcType="TIMESTAMP" />
    <result property="claimedBy" column="CLAIMED_BY_" jdbcType="NVARCHAR"/>
    <result property="suspendedTime" column="SUSPENDED_TIME_" jdbcType="TIMESTAMP" />
    <result property="suspendedBy" column="SUSPENDED_BY_" jdbcType="NVARCHAR"/>
    <result property="owner" column="OWNER_" jdbcType="NVARCHAR"/>
    <result property="assignee" column="ASSIGNEE_" jdbcType="NVARCHAR"/>
    <result property="delegationStateString" column="DELEGATION_" jdbcType="NVARCHAR"/>
    <result property="executionId" column="EXECUTION_ID_" jdbcType="NVARCHAR" />
    <result property="processInstanceId" column="PROC_INST_ID_" jdbcType="NVARCHAR" />
    <result property="processDefinitionId" column="PROC_DEF_ID_" jdbcType="NVARCHAR"/>
    <result property="taskDefinitionId" column="TASK_DEF_ID_" jdbcType="NVARCHAR"/>
    <result property="scopeId" column="SCOPE_ID_" jdbcType="NVARCHAR"/>
    <result property="subScopeId" column="SUB_SCOPE_ID_" jdbcType="NVARCHAR"/>
    <result property="scopeType" column="SCOPE_TYPE_" jdbcType="NVARCHAR"/>
    <result property="scopeDefinitionId" column="SCOPE_DEFINITION_ID_" jdbcType="NVARCHAR"/>
    <result property="propagatedStageInstanceId" column="PROPAGATED_STAGE_INST_ID_" jdbcType="NVARCHAR"/>
    <result property="taskDefinitionKey" column="TASK_DEF_KEY_" jdbcType="NVARCHAR"/>
    <result property="state" column="STATE_" jdbcType="NVARCHAR"/>
    <result property="inProgressStartDueDate" column="IN_PROGRESS_DUE_DATE_" jdbcType="TIMESTAMP"/>
    <result property="dueDate" column="DUE_DATE_" jdbcType="TIMESTAMP"/>
    <result property="category" column="CATEGORY_" jdbcType="NVARCHAR" />
    <result property="suspensionState" column="SUSPENSION_STATE_" jdbcType="INTEGER" />
    <result property="tenantId" column="TENANT_ID_" jdbcType="NVARCHAR" />
    <result property="formKey" column="FORM_KEY_" jdbcType="NVARCHAR" />
    <result property="claimTime" column="CLAIM_TIME_" jdbcType="TIMESTAMP" />
    <result property="isCountEnabled" column="IS_COUNT_ENABLED_" jdbcType="BOOLEAN" />
    <result property="variableCount" column="VAR_COUNT_" jdbcType="INTEGER" />
    <result property="identityLinkCount" column="ID_LINK_COUNT_" jdbcType="INTEGER" />
    <result property="subTaskCount" column="SUB_TASK_COUNT_" jdbcType="INTEGER" />
    <collection property="queryVariables" column="TASK_ID_" javaType="ArrayList" ofType="org.flowable.variable.service.impl.persistence.entity.VariableInstanceEntityImpl">
      <id property="id" column="VAR_ID_" jdbcType="NVARCHAR"/>
      <result property="name" column="VAR_NAME_" javaType="String" jdbcType="NVARCHAR" />
      <result property="type" column="VAR_TYPE_" javaType="org.flowable.variable.api.types.VariableType" jdbcType="NVARCHAR" />
      <result property="revision" column="VAR_REV_" jdbcType="INTEGER" />
      <result property="processInstanceId" column="VAR_PROC_INST_ID_" jdbcType="NVARCHAR" />
      <result property="executionId" column="VAR_EXECUTION_ID_" jdbcType="NVARCHAR" />
      <result property="taskId" column="VAR_TASK_ID_" jdbcType="NVARCHAR" />
      <result property="metaInfo" column="VAR_META_INFO_" jdbcType="NVARCHAR" />
      <result property="byteArrayRef" column="VAR_BYTEARRAY_ID_" typeHandler="VariableByteArrayRefTypeHandler"/>
      <result property="doubleValue" column="VAR_DOUBLE_" jdbcType="DOUBLE" />
      <result property="textValue" column="VAR_TEXT_" jdbcType="NVARCHAR" />
      <result property="textValue2" column="VAR_TEXT2_" jdbcType="NVARCHAR" />
      <result property="longValue" column="VAR_LONG_" jdbcType="BIGINT" />
      <result property="scopeId" column="VAR_SCOPE_ID_" jdbcType="NVARCHAR"/>
      <result property="subScopeId" column="VAR_SUB_SCOPE_ID_" jdbcType="NVARCHAR"/>
      <result property="scopeType" column="VAR_SCOPE_TYPE_" jdbcType="NVARCHAR"/>
    </collection>
    <collection property="queryIdentityLinks" column="TASK_ID_" javaType="ArrayList" ofType="org.flowable.identitylink.service.impl.persistence.entity.IdentityLinkEntityImpl">
      <id property="id" column="ILINK_ID_" jdbcType="NVARCHAR"/>
      <result property="type" column="ILINK_TYPE_" jdbcType="NVARCHAR" />
      <result property="userId" column="ILINK_USER_ID_" jdbcType="NVARCHAR" />
      <result property="groupId" column="ILINK_GROUP_ID_" jdbcType="NVARCHAR" />
      <result property="taskId" column="ILINK_TASK_ID_" jdbcType="NVARCHAR" />
      <result property="processInstanceId" column="ILINK_PROC_INST_ID_" jdbcType="NVARCHAR" />
      <result property="processDefId" column="ILINK_PROC_DEF_ID_" jdbcType="NVARCHAR" />
    </collection>
  </resultMap>

  <!-- TASK SELECT -->

  <select id="selectTask" parameterType="string" resultMap="taskResultMap">
   select * from ${prefix}ACT_RU_TASK where ID_ = #{id, jdbcType=NVARCHAR}
  </select>

  <select id="selectTasksByParentTaskId" parameterType="org.flowable.common.engine.impl.db.ListQueryParameterObject" resultMap="taskResultMap">
    select * from ${prefix}ACT_RU_TASK where PARENT_TASK_ID_ = #{parameter, jdbcType=NVARCHAR}
  </select>

  <select id="selectTasksByExecutionId" parameterType="org.flowable.common.engine.impl.db.ListQueryParameterObject" resultMap="taskResultMap">
    select distinct T.*
    from ${prefix}ACT_RU_TASK T
    where T.EXECUTION_ID_ = #{parameter, jdbcType=NVARCHAR}
  </select>

  <select id="selectTasksByProcessInstanceId" parameterType="org.flowable.common.engine.impl.db.ListQueryParameterObject" resultMap="taskResultMap">
    select T.*
    from ${prefix}ACT_RU_TASK T
    where T.PROC_INST_ID_ = #{parameter, jdbcType=NVARCHAR}
  </select>

  <select id="selectTasksBySubScopeIdAndScopeType" parameterType="org.flowable.common.engine.impl.db.ListQueryParameterObject" resultMap="taskResultMap">
    select T.*
    from ${prefix}ACT_RU_TASK T
    where T.SUB_SCOPE_ID_ = #{parameter.subScopeId, jdbcType=NVARCHAR} and T.SCOPE_TYPE_ = #{parameter.scopeType, jdbcType=NVARCHAR}
  </select>

  <select id="selectTasksByScopeIdAndScopeType" parameterType="org.flowable.common.engine.impl.db.ListQueryParameterObject" resultMap="taskResultMap">
    select T.*
    from ${prefix}ACT_RU_TASK T
    where T.SCOPE_ID_ = #{parameter.scopeId, jdbcType=NVARCHAR} and T.SCOPE_TYPE_ = #{parameter.scopeType, jdbcType=NVARCHAR}
  </select>

  <select id="selectTaskByQueryCriteria" parameterType="org.flowable.task.service.impl.TaskQueryImpl" resultMap="taskResultMap">
      <if test="needsPaging">${limitBefore}</if>
      SELECT RES.* <if test="needsPaging">${limitBetween}</if>
      <include refid="selectTaskByQueryCriteriaSql"/>
      ${orderBy}
      <if test="needsPaging">${limitAfter}</if>
  </select>

  <select id="selectTaskCountByQueryCriteria" parameterType="org.flowable.task.service.impl.TaskQueryImpl" resultType="long">
    select count(distinct RES.ID_)
    <include refid="selectTaskByQueryCriteriaSql"/>
  </select>

  <sql id="selectTaskByQueryCriteriaSql">
    from ${prefix}ACT_RU_TASK RES
    <include refid="commonSelectTaskByQueryCriteriaSql"/>
  </sql>

    <!-- The ordering and the querying is done within a sub select, and then we do a join on the related entities -->
  <select id="selectTasksWithRelatedEntitiesByQueryCriteria" parameterType="org.flowable.task.service.impl.TaskQueryImpl" resultMap="taskAndRelatedEntitiesResultMap">
      SELECT RES.*,
      <if test="includeTaskLocalVariables or includeProcessVariables or includeCaseVariables">
          VAR.ID_ as VAR_ID_, VAR.NAME_ as VAR_NAME_, VAR.TYPE_ as VAR_TYPE_, VAR.REV_ as VAR_REV_,
          VAR.PROC_INST_ID_ as VAR_PROC_INST_ID_, VAR.EXECUTION_ID_ as VAR_EXECUTION_ID_, VAR.TASK_ID_ as VAR_TASK_ID_,
          VAR.META_INFO_ as VAR_META_INFO_,
          VAR.BYTEARRAY_ID_ as VAR_BYTEARRAY_ID_, VAR.DOUBLE_ as VAR_DOUBLE_,
          VAR.TEXT_ as VAR_TEXT_, VAR.TEXT2_ as VAR_TEXT2_, VAR.LONG_ as VAR_LONG_,
          VAR.SCOPE_ID_ AS VAR_SCOPE_ID_, VAR.SUB_SCOPE_ID_ AS VAR_SUB_SCOPE_ID_,VAR.SCOPE_TYPE_ AS VAR_SCOPE_TYPE_
      </if>
      <if test="(includeTaskLocalVariables or includeProcessVariables or includeCaseVariables) and includeIdentityLinks">
          ,
      </if>
      <if test="includeIdentityLinks">
          ILINK.ID_ as ILINK_ID_, ILINK.TYPE_ as ILINK_TYPE_, ILINK.USER_ID_ as ILINK_USER_ID_,
          ILINK.GROUP_ID_ as ILINK_GROUP_ID_, ILINK.TASK_ID_ as ILINK_TASK_ID_,
          ILINK.PROC_INST_ID_ as ILINK_PROC_INST_ID_, ILINK.PROC_DEF_ID_ as ILINK_PROC_DEF_ID_,
          ILINK.SCOPE_ID_ as ILINK_SCOPE_ID_, ILINK.SCOPE_DEFINITION_ID_ AS ILINK_SCOPE_DEFINITION_ID_
      </if>
      FROM (
      <!-- top 100 percent is only needed when doing order by in a subselect -->
      <if test="needsPaging">${limitBefore}</if>
      SELECT <if test="_databaseId == 'mssql'">top 100 percent</if> RES.* <if test="needsPaging">${limitBetween}</if>
      <include refid="selectTaskByQueryCriteriaSql"/>
      ${orderBy}
      <if test="needsPaging">${limitAfter}</if>
      ) RES
      <if test="includeTaskLocalVariables or includeProcessVariables or includeCaseVariables">
          left outer join ${prefix}ACT_RU_VARIABLE VAR ON
          <trim prefixOverrides="OR">
              <if test="includeTaskLocalVariables">OR RES.ID_ = VAR.TASK_ID_</if>
              <if test="includeProcessVariables">OR (RES.PROC_INST_ID_ = VAR.EXECUTION_ID_)</if>
              <if test="includeCaseVariables">OR (RES.SCOPE_ID_ = VAR.SCOPE_ID_ AND VAR.SCOPE_TYPE_ = 'cmmn' AND VAR.TASK_ID_ IS NULL)</if>
          </trim>
      </if>
      <if test="includeIdentityLinks">
          left outer join ${prefix}ACT_RU_IDENTITYLINK ILINK on RES.ID_ = ILINK.TASK_ID_
      </if>
      ${outerJoinOrderBy}
  </select>

  <sql id="commonSelectTaskByQueryCriteriaSql">
    <where>
      <if test="taskId != null">
        RES.ID_ = #{taskId, jdbcType=NVARCHAR}
      </if>
      <if test="taskIds != null and !taskIds.empty">
          AND RES.ID_ IN
          <foreach item="taskId" index="index" collection="taskIds" open="(" separator="," close=")">
              #{taskId, jdbcType=NVARCHAR}
          </foreach>
      </if>
      <if test="name != null">
        and RES.NAME_ = #{name, jdbcType=NVARCHAR}
      </if>
      <if test="nameLike != null">
        and RES.NAME_ like #{nameLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
      </if>
      <if test="nameLikeIgnoreCase != null">
        and lower(RES.NAME_) like lower(#{nameLikeIgnoreCase, jdbcType=NVARCHAR})${wildcardEscapeClause}
      </if>
      <if test="nameList != null &amp;&amp; !nameList.empty">
        and RES.NAME_ IN
        <foreach item="name" index="index" collection="nameList"
                 open="(" separator="," close=")">
          #{name, jdbcType=NVARCHAR}
        </foreach>
      </if>
      <if test="nameListIgnoreCase != null &amp;&amp; !nameListIgnoreCase.empty">
        and lower(RES.NAME_) IN
        <foreach item="name" index="index" collection="nameListIgnoreCase"
                 open="(" separator="," close=")">
          #{name, jdbcType=NVARCHAR}
        </foreach>
      </if>
      <if test="description != null">
        and RES.DESCRIPTION_ = #{description, jdbcType=NVARCHAR}
      </if>
      <if test="descriptionLike != null">
        and RES.DESCRIPTION_ like #{descriptionLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
      </if>
      <if test="descriptionLikeIgnoreCase != null">
        and lower(RES.DESCRIPTION_) like #{descriptionLikeIgnoreCase, jdbcType=NVARCHAR}${wildcardEscapeClause}
      </if>
      <if test="priority != null">
        and RES.PRIORITY_ = #{priority, jdbcType=INTEGER}
      </if>
      <if test="minPriority != null">
        and RES.PRIORITY_ &gt;= #{minPriority, jdbcType=INTEGER}
      </if>
      <if test="maxPriority != null">
        and RES.PRIORITY_ &lt;= #{maxPriority, jdbcType=INTEGER}
      </if>
      <if test="assignee != null">
        and RES.ASSIGNEE_ = #{assignee, jdbcType=NVARCHAR}
      </if>
      <if test="assigneeLike != null">
        and RES.ASSIGNEE_ like #{assigneeLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
      </if>
      <if test="assigneeLikeIgnoreCase != null">
        and lower(RES.ASSIGNEE_) like #{assigneeLikeIgnoreCase, jdbcType=NVARCHAR}${wildcardEscapeClause}
      </if>
      <if test="assigneeIds != null &amp;&amp; !assigneeIds.empty">
        and RES.ASSIGNEE_ IN
        <foreach item="assigneeId" index="index" collection="assigneeIds"
                 open="(" separator="," close=")">
          #{assigneeId, jdbcType=NVARCHAR}
        </foreach>
      </if>
      <if test="owner != null">
        and RES.OWNER_ = #{owner, jdbcType=NVARCHAR}
      </if>
      <if test="ownerLike != null">
        and RES.OWNER_ like #{ownerLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
      </if>
       <if test="ownerLikeIgnoreCase != null">
        and lower(RES.OWNER_) like #{ownerLikeIgnoreCase, jdbcType=NVARCHAR}${wildcardEscapeClause}
      </if>
      <if test="unassigned">
        and RES.ASSIGNEE_ IS NULL
      </if>
      <if test="withAssignee">
        and RES.ASSIGNEE_ IS NOT NULL
      </if>
      <if test="noDelegationState">
        and RES.DELEGATION_ IS NULL
      </if>
      <if test="delegationState != null">
        and RES.DELEGATION_ = #{delegationStateString, jdbcType=NVARCHAR}
      </if>
      <if test="processInstanceId != null">
        and RES.PROC_INST_ID_ = #{processInstanceId, jdbcType=NVARCHAR}
      </if>
      <if test="processInstanceIds != null &amp;&amp; !processInstanceIds.empty">
        and RES.PROC_INST_ID_ IN
        <foreach item="processInstanceId" index="index" collection="processInstanceIds"
                 open="(" separator="," close=")">
          #{processInstanceId, jdbcType=NVARCHAR}
        </foreach>
      </if>
      <if test="withoutProcessInstanceId">
        and RES.PROC_INST_ID_ is NULL
      </if>
      <if test="processInstanceBusinessKey != null || processInstanceBusinessKeyLike != null  || processInstanceBusinessKeyLikeIgnoreCase != null">
          and exists (
            select 1
            from ${prefix}ACT_RU_EXECUTION E
            <where>
                RES.PROC_INST_ID_ = E.ID_
                <if test="processInstanceBusinessKey != null">
                    and E.BUSINESS_KEY_ = #{processInstanceBusinessKey, jdbcType=NVARCHAR}
                </if>
                <if test="processInstanceBusinessKeyLike != null">
                    and E.BUSINESS_KEY_ like #{processInstanceBusinessKeyLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
                </if>
                <if test="processInstanceBusinessKeyLikeIgnoreCase != null">
                    and lower(E.BUSINESS_KEY_) like #{processInstanceBusinessKeyLikeIgnoreCase, jdbcType=NVARCHAR}${wildcardEscapeClause}
                </if>
            </where>
          )
      </if>
      <if test="executionId != null">
        and RES.EXECUTION_ID_ = #{executionId, jdbcType=NVARCHAR}
      </if>
      <if test="scopeId != null">
        and RES.SCOPE_ID_ = #{scopeId, jdbcType=NVARCHAR}
      </if>
      <if test="scopeIds != null &amp;&amp; !scopeIds.empty">
          and (
          <foreach item="scopeIdListItem" index="groupIndex" collection="safeScopeIds">
              <if test="groupIndex &gt; 0">
                  or
              </if>
              RES.SCOPE_ID_ IN
              <foreach item="scopeId" index="index" collection="scopeIdListItem" open="(" separator="," close=")">
                  #{scopeId, jdbcType=NVARCHAR}
              </foreach>
          </foreach>
          )
      </if>
      <if test="subScopeId != null">
        and RES.SUB_SCOPE_ID_ = #{subScopeId, jdbcType=NVARCHAR}
      </if>
      <if test="scopeType != null">
        and RES.SCOPE_TYPE_ = #{scopeType, jdbcType=NVARCHAR}
      </if>
      <if test="scopeDefinitionId != null">
        and RES.SCOPE_DEFINITION_ID_ = #{scopeDefinitionId, jdbcType=NVARCHAR}
      </if>
      <if test="withoutScopeId">
        and RES.SCOPE_ID_ is NULL
      </if>
      <if test="propagatedStageInstanceId != null">
        and RES.PROPAGATED_STAGE_INST_ID_ = #{propagatedStageInstanceId, jdbcType=NVARCHAR}
      </if>
      <if test="processInstanceIdWithChildren != null">
        and exists(select ELINK.ID_ from ${prefix}ACT_RU_ENTITYLINK ELINK where ELINK.LINK_TYPE_ = 'child' and
            ELINK.SCOPE_ID_ = #{processInstanceIdWithChildren, jdbcType=NVARCHAR} AND ELINK.SCOPE_TYPE_ = 'bpmn' and
            ELINK.REF_SCOPE_ID_ = RES.ID_ and ELINK.REF_SCOPE_TYPE_ = 'task')
      </if>
      <if test="caseInstanceIdWithChildren != null">
        and exists(select ELINK.ID_ from ${prefix}ACT_RU_ENTITYLINK ELINK where ELINK.LINK_TYPE_ = 'child' and
            ELINK.SCOPE_ID_ = #{caseInstanceIdWithChildren, jdbcType=VARCHAR} AND ELINK.SCOPE_TYPE_ = 'cmmn' and
            ELINK.REF_SCOPE_ID_ = RES.ID_ and ELINK.REF_SCOPE_TYPE_ = 'task')
      </if>
      <if test="createTime != null">
        and RES.CREATE_TIME_ = #{createTime, jdbcType=TIMESTAMP}
      </if>
      <if test="createTimeBefore != null">
        and RES.CREATE_TIME_ &lt; #{createTimeBefore, jdbcType=TIMESTAMP}
      </if>
      <if test="createTimeAfter != null">
        and RES.CREATE_TIME_ &gt; #{createTimeAfter, jdbcType=TIMESTAMP}
      </if>
      <if test="inProgressStartTime != null">
        and RES.IN_PROGRESS_TIME_ = #{inProgressStartTime, jdbcType=TIMESTAMP}
      </if>
      <if test="inProgressStartTimeBefore != null">
        and RES.IN_PROGRESS_TIME_ &lt; #{inProgressStartTimeBefore, jdbcType=TIMESTAMP}
      </if>
      <if test="inProgressStartTimeAfter != null">
        and RES.IN_PROGRESS_TIME_ &gt; #{inProgressStartTimeAfter, jdbcType=TIMESTAMP}
      </if>
      <if test="key != null">
        and RES.TASK_DEF_KEY_ = #{key, jdbcType=NVARCHAR}
      </if>
      <if test="keyLike != null">
        and RES.TASK_DEF_KEY_ like #{keyLike, jdbcType=NVARCHAR}
      </if>
      <if test="keys != null and !keys.empty">
          and RES.TASK_DEF_KEY_ in
          <foreach item="taskDefinitionKey" index="index" collection="keys" open="(" separator="," close=")">
              #{taskDefinitionKey, jdbcType=NVARCHAR}
          </foreach>
      </if>
      <if test="processDefinitionId != null">
        and RES.PROC_DEF_ID_ = #{processDefinitionId, jdbcType=NVARCHAR}
      </if>
      <if test="taskDefinitionId != null">
        and RES.TASK_DEF_ID_ = #{taskDefinitionId, jdbcType=NVARCHAR}
      </if>
      <if test="processDefinitionKey != null || processDefinitionKeyLike != null ||  processDefinitionKeyLikeIgnoreCase != null || processDefinitionName != null || processDefinitionNameLike != null || (processCategoryInList != null &amp;&amp; !processCategoryInList.empty) || (processCategoryNotInList != null &amp;&amp; !processCategoryNotInList.empty) || (processDefinitionKeys != null &amp;&amp; !processDefinitionKeys.empty) || deploymentId != null || (deploymentIds != null &amp;&amp; !deploymentIds.empty)">
        and exists (
            select 1
            from ${prefix}ACT_RE_PROCDEF D
            <where>
                RES.PROC_DEF_ID_ = D.ID_
                <if test="processDefinitionKey != null">
                    and D.KEY_ = #{processDefinitionKey, jdbcType=NVARCHAR}
                </if>
                <if test="processDefinitionKeyLike != null">
                    and D.KEY_ like #{processDefinitionKeyLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
                </if>
                <if test="processDefinitionKeyLikeIgnoreCase != null">
                    and lower(D.KEY_) like #{processDefinitionKeyLikeIgnoreCase, jdbcType=NVARCHAR}${wildcardEscapeClause}
                </if>
                <if test="processDefinitionKeys != null &amp;&amp; !processDefinitionKeys.empty">
                    and D.KEY_ in
                    <foreach item="processDefinitionKey" index="index" collection="processDefinitionKeys" open="(" separator="," close=")">
                        #{processDefinitionKey, jdbcType=NVARCHAR}
                    </foreach>
                </if>
                <if test="processDefinitionName != null">
                    and D.NAME_ = #{processDefinitionName, jdbcType=NVARCHAR}
                </if>
                <if test="processDefinitionNameLike != null">
                    and D.NAME_ like #{processDefinitionNameLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
                </if>
                <if test="processCategoryInList != null &amp;&amp; !processCategoryInList.empty">
                    and D.CATEGORY_ IN
                    <foreach item="processCategory" index="index" collection="processCategoryInList"
                             open="(" separator="," close=")">
                        #{processCategory, jdbcType=NVARCHAR}
                    </foreach>
                </if>
                <if test="processCategoryNotInList != null &amp;&amp; !processCategoryNotInList.empty">
                    and D.CATEGORY_ NOT IN
                    <foreach item="processCategory" index="index" collection="processCategoryNotInList"
                             open="(" separator="," close=")">
                        #{processCategory, jdbcType=NVARCHAR}
                    </foreach>
                </if>
                <if test="deploymentId != null">
                    and D.DEPLOYMENT_ID_ = #{deploymentId, jdbcType=NVARCHAR}
                </if>
                <if test="deploymentIds != null &amp;&amp; !deploymentIds.empty">
                    and D.DEPLOYMENT_ID_ IN
                    <foreach item="deploymentId" index="index" collection="deploymentIds"
                             open="(" separator="," close=")">
                        #{deploymentId, jdbcType=NVARCHAR}
                    </foreach>
                </if>
            </where>
          )
      </if>
      <if test="caseDefinitionKey != null || caseDefinitionKeyLike != null ||  caseDefinitionKeyLikeIgnoreCase != null || (caseDefinitionKeys != null &amp;&amp; !caseDefinitionKeys.empty) || cmmnDeploymentId != null || (cmmnDeploymentIds != null &amp;&amp; !cmmnDeploymentIds.empty)">
          and exists (
            select 1
            from ${prefix}ACT_CMMN_CASEDEF CD
            <where>
                RES.SCOPE_DEFINITION_ID_ = CD.ID_
                <if test="caseDefinitionKey != null">
                    and CD.KEY_ = #{caseDefinitionKey, jdbcType=VARCHAR}
                </if>
                <if test="caseDefinitionKeyLike != null">
                    and CD.KEY_ like #{caseDefinitionKeyLike, jdbcType=VARCHAR}${wildcardEscapeClause}
                </if>
                <if test="caseDefinitionKeyLikeIgnoreCase != null">
                    and lower(CD.KEY_) like #{caseDefinitionKeyLikeIgnoreCase, jdbcType=VARCHAR}${wildcardEscapeClause}
                </if>
                <if test="caseDefinitionKeys != null &amp;&amp; !caseDefinitionKeys.empty">
                    and CD.KEY_ in
                    <foreach item="caseDefinitionKey" index="index" collection="caseDefinitionKeys" open="(" separator="," close=")">
                        #{caseDefinitionKey, jdbcType=VARCHAR}
                    </foreach>
                </if>
                <if test="cmmnDeploymentId != null">
                    and CD.DEPLOYMENT_ID_ = #{cmmnDeploymentId, jdbcType=VARCHAR}
                </if>
                <if test="cmmnDeploymentIds != null &amp;&amp; !cmmnDeploymentIds.empty">
                    and CD.DEPLOYMENT_ID_ IN
                    <foreach item="cmmnDeploymentId" index="index" collection="cmmnDeploymentIds"
                             open="(" separator="," close=")">
                        #{cmmnDeploymentId, jdbcType=VARCHAR}
                    </foreach>
                </if>
            </where>
          )
      </if>
      <if test="dueDate != null">
        and RES.DUE_DATE_ = #{dueDate, jdbcType=TIMESTAMP}
      </if>
      <if test="dueBefore != null">
        and RES.DUE_DATE_ &lt; #{dueBefore, jdbcType=TIMESTAMP}
      </if>
      <if test="dueAfter != null">
        and RES.DUE_DATE_ &gt; #{dueAfter, jdbcType=TIMESTAMP}
      </if>
      <if test="withoutDueDate">
        and RES.DUE_DATE_ is null
      </if>
      <if test="dueDate != null || dueBefore != null || dueAfter != null">
        and RES.DUE_DATE_ is not null
      </if>
      <if test="category != null">
        and RES.CATEGORY_ = #{category, jdbcType=NVARCHAR}
      </if>
      <if test="categoryInList != null &amp;&amp; !categoryInList.empty">
          and RES.CATEGORY_ IN
          <foreach item="category" index="index" collection="categoryInList"
                   open="(" separator="," close=")">
              #{category, jdbcType=NVARCHAR}
          </foreach>
      </if>
      <if test="categoryNotInList != null &amp;&amp; !categoryNotInList.empty">
          and RES.CATEGORY_ NOT IN
          <foreach item="category" index="index" collection="categoryNotInList"
                     open="(" separator="," close=")">
              #{category, jdbcType=NVARCHAR}
            </foreach>
      </if>
      <if test="withoutCategory">
        and RES.CATEGORY_ IS NULL
      </if>
      <if test="withFormKey">
        and RES.FORM_KEY_ IS NOT NULL
      </if>
        <if test="formKey != null">
            and RES.FORM_KEY_ = #{formKey, jdbcType=NVARCHAR}
        </if>
      <if test="excludeSubtasks">
        and RES.PARENT_TASK_ID_ IS NULL
      </if>
      <if test="!bothCandidateAndAssigned &amp;&amp; (candidateUser != null || candidateGroups != null)">
        <if test="!ignoreAssigneeValue">
            and RES.ASSIGNEE_ is null
        </if>
        and exists(select LINK.ID_ from ${prefix}ACT_RU_IDENTITYLINK LINK where LINK.TYPE_ = 'candidate' and LINK.TASK_ID_ = RES.ID_
            and
            (
              <if test="candidateUser != null">
                LINK.USER_ID_ = #{candidateUser, jdbcType=NVARCHAR}
              </if>
              <if test="candidateUser != null &amp;&amp; candidateGroups != null &amp;&amp; !candidateGroups.empty">
                or
              </if>
              <if test="candidateGroups != null &amp;&amp; !candidateGroups.empty">
                (
                <foreach item="candidateGroupListItem" index="groupIndex" collection="safeCandidateGroups">
                    <if test="groupIndex &gt; 0">
                    or
                    </if>
                    LINK.GROUP_ID_ IN
                    <foreach item="groupId" index="index" collection="candidateGroupListItem"
                         open="(" separator="," close=")">
                      #{groupId, jdbcType=NVARCHAR}
                    </foreach>
                </foreach>
                )
              </if>
            )
        )
      </if>
      <if test="involvedUser != null">
        and (
          exists(select LINK.ID_ from ${prefix}ACT_RU_IDENTITYLINK LINK where LINK.USER_ID_ = #{involvedUser, jdbcType=NVARCHAR} and LINK.TASK_ID_ = RES.ID_)
          or RES.ASSIGNEE_ = #{involvedUser, jdbcType=NVARCHAR}
          or RES.OWNER_ = #{involvedUser, jdbcType=NVARCHAR}
          )
      </if>
      <if test="involvedGroups != null">
        and EXISTS(
          select ID_ from ${prefix}ACT_RU_IDENTITYLINK LINK where LINK.TASK_ID_ = RES.ID_ and
            (
    		<foreach item="involvedGroupListItem" index="groupIndex" collection="safeInvolvedGroups">
    			<if test="groupIndex &gt; 0">
    			or
    			</if>
                LINK.GROUP_ID_ IN
                <foreach item="groupId" index="index" collection="involvedGroupListItem"
                      open="(" separator="," close=")">
                  #{groupId, jdbcType=NVARCHAR}
                </foreach>
            </foreach>
            )
        )
      </if>
      <foreach item="var" collection="queryVariableValues" index="index">
        <choose>
            <when test="var.operator.equals('EXISTS')">
              and EXISTS (
                select ID_ from ${prefix}ACT_RU_VARIABLE where NAME_ = #{var.name, jdbcType=NVARCHAR}
                <if test="!var.local">
                    <choose>
                        <when test="var.scopeType == null or var.scopeType == 'bpmn'">
                            and RES.PROC_INST_ID_ = PROC_INST_ID_
                        </when>
                        <otherwise>
                            and RES.SCOPE_ID_ = SCOPE_ID_ and SCOPE_TYPE_ = #{var.scopeType, jdbcType=NVARCHAR}
                        </otherwise>
                    </choose>
                    and TASK_ID_ is null
                </if>
                <if test="var.local">
                    and RES.ID_ = TASK_ID_
                </if>
              )
            </when>
            <when test="var.operator.equals('NOT_EXISTS')">
              and NOT EXISTS (
                select ID_ from ${prefix}ACT_RU_VARIABLE where NAME_ = #{var.name, jdbcType=NVARCHAR}
                <if test="!var.local">
                    <choose>
                        <when test="var.scopeType == null or var.scopeType == 'bpmn'">
                            and RES.PROC_INST_ID_ = PROC_INST_ID_
                        </when>
                        <otherwise>
                            and RES.SCOPE_ID_ = SCOPE_ID_ and SCOPE_TYPE_ = #{var.scopeType, jdbcType=NVARCHAR}
                        </otherwise>
                    </choose>
                    and TASK_ID_ is null
                </if>
                <if test="var.local">
                    and RES.ID_ = TASK_ID_
                </if>
              )
            </when>
            <otherwise>
                and exists (
                    select 1
                    from ${prefix}ACT_RU_VARIABLE V
                    <where>
                        <if test="!var.local">
                            <choose>
                                <when test="var.scopeType == null or var.scopeType == 'bpmn'">
                                    and RES.PROC_INST_ID_ = V.PROC_INST_ID_
                                </when>
                                <otherwise>
                                    and RES.SCOPE_ID_ = V.SCOPE_ID_ and V.SCOPE_TYPE_ = #{var.scopeType, jdbcType=NVARCHAR}
                                </otherwise>
                            </choose>
                            and V.TASK_ID_ is null
                        </if>
                        <if test="var.local">
                            and RES.ID_ = V.TASK_ID_
                        </if>
                        <if test="var.name != null">
                            <!-- Match-all variable-names when name is null -->
                            and V.NAME_= #{var.name, jdbcType=NVARCHAR}
                        </if>
                        <if test="var.name == null">
                            and V.NAME_ is not null
                        </if>
                        <if test="var.needsTypeCheck()">
                            and V.TYPE_ = #{var.type, jdbcType=NVARCHAR}
                        </if>

                        <!-- Variable value -->
                        <if test="var.textValue != null &amp;&amp; var.longValue == null &amp;&amp; var.doubleValue == null">
                            <choose>
                                <when test="var.operator.equals('EQUALS_IGNORE_CASE') || var.operator.equals('NOT_EQUALS_IGNORE_CASE') || var.operator.equals('LIKE_IGNORE_CASE')">
                                    and (lower(V.TEXT_)
                                </when>
                                <otherwise>
                                    and (V.TEXT_
                                </otherwise>
                            </choose>
                            <choose>
                                <when test="var.operator.equals('LIKE') || var.operator.equals('LIKE_IGNORE_CASE')">LIKE</when>
                                <otherwise><include refid="executionVariableOperator" /></otherwise>
                            </choose>
                            #{var.textValue, jdbcType=NVARCHAR}
                            <choose>
                                <when test="var.operator.equals('LIKE') || var.operator.equals('LIKE_IGNORE_CASE')">${wildcardEscapeClause}</when>
                            </choose>
                            <if test="var.operator.equals('NOT_EQUALS') || var.operator.equals('NOT_EQUALS_IGNORE_CASE')">
                                or V.TEXT_ is null
                            </if>
                            )
                        </if>
                        <if test="var.textValue2 != null">
                            and V.TEXT2_
                            <choose>
                                <when test="var.operator.equals('LIKE')">LIKE</when>
                                <otherwise><include refid="executionVariableOperator" /></otherwise>
                            </choose>
                            #{var.textValue2, jdbcType=NVARCHAR}
                            <choose>
                                <when test="var.operator.equals('LIKE')">${wildcardEscapeClause}</when>
                            </choose>
                        </if>
                        <if test="var.longValue != null">
                            and (V.LONG_
                            <include refid="executionVariableOperator" />
                            #{var.longValue, jdbcType=BIGINT}
                            <if test="var.operator.equals('NOT_EQUALS') || var.operator.equals('NOT_EQUALS_IGNORE_CASE')">
                                or V.LONG_ is null
                            </if>
                            )
                        </if>
                        <if test="var.doubleValue != null">
                            and (V.DOUBLE_
                            <include refid="executionVariableOperator" />
                            #{var.doubleValue, jdbcType=DOUBLE}
                            <if test="var.operator.equals('NOT_EQUALS') || var.operator.equals('NOT_EQUALS_IGNORE_CASE')">
                                or V.DOUBLE_ is null
                            </if>
                            )
                        </if>
                        <!-- Null variable type -->
                        <if test="var.textValue == null &amp;&amp; var.textValue2 == null &amp;&amp; var.longValue == null &amp;&amp; var.doubleValue == null">
                            <choose>
                                <when test="var.operator.equals('NOT_EQUALS')">
                                    and (V.TEXT_ is not null or V.TEXT2_ is not null or V.LONG_ is not null or V.DOUBLE_ is not null or V.BYTEARRAY_ID_ is not null)
                                </when>
                                <otherwise>
                                    and V.TEXT_ is null and V.TEXT2_ is null and V.LONG_ is null and V.DOUBLE_ is null and V.BYTEARRAY_ID_ is null
                                </otherwise>
                            </choose>
                        </if>
                    </where>
                )
            </otherwise>
        </choose>
      </foreach>
      <if test="suspensionState != null">
        <if test="suspensionState.stateCode == 1">
            and RES.SUSPENSION_STATE_ = 1
        </if>
        <if test="suspensionState.stateCode == 2">
            and RES.SUSPENSION_STATE_ = 2
        </if>
      </if>
      <if test="tenantId != null">
        and RES.TENANT_ID_ = #{tenantId, jdbcType=NVARCHAR}
      </if>
      <if test="tenantIdLike != null">
        and RES.TENANT_ID_ like #{tenantIdLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
      </if>
      <if test="withoutTenantId">
        and (RES.TENANT_ID_ = '' or RES.TENANT_ID_ is null)
      </if>
      <if test="parentScopeId != null">
        and EXISTS(select 1 from ${prefix}ACT_RU_ENTITYLINK LINK where
            LINK.SCOPE_ID_ = #{parentScopeId, jdbcType=NVARCHAR}
            and LINK.REF_SCOPE_ID_ = RES.ID_
            and LINK.HIERARCHY_TYPE_ = 'parent'
        )
      </if>
      <if test="rootScopeId != null">
        and exists(
            select 1 from ${prefix}ACT_RU_ENTITYLINK LINK where
                LINK.REF_SCOPE_ID_ = RES.ID_
                and LINK.ROOT_SCOPE_ID_ = #{rootScopeId, jdbcType=NVARCHAR}
        )
      </if>
      <choose>
        <when test="bothCandidateAndAssigned">
          <!-- if dbIdentityUsed set true in process engine configuration -->
          <if test="userIdForCandidateAndAssignee != null">
            <if test="candidateGroups == null">
              and (RES.ASSIGNEE_ = #{userIdForCandidateAndAssignee, jdbcType=NVARCHAR}
                or (
                <if test="!ignoreAssigneeValue">
                    RES.ASSIGNEE_ is null and
                </if>
                exists(select LINK.ID_ from ${prefix}ACT_RU_IDENTITYLINK LINK where LINK.TASK_ID_ = RES.ID_
                and (LINK.USER_ID_ = #{userIdForCandidateAndAssignee, jdbcType=NVARCHAR}
                or LINK.GROUP_ID_ IN (select g.GROUP_ID_ from ${prefix}ACT_ID_MEMBERSHIP g where g.USER_ID_ = #{userIdForCandidateAndAssignee, jdbcType=NVARCHAR} )))))
            </if>
          </if>
          <!-- if dbIdentityUsed set false in process engine configuration of using custom session factory of GroupIdentityManager -->
          <if test="candidateGroups != null">
            and (RES.ASSIGNEE_ = #{userIdForCandidateAndAssignee, jdbcType=NVARCHAR}
              or (
              <if test="!ignoreAssigneeValue">
                RES.ASSIGNEE_ is null and
              </if>
                exists(select LINK.ID_ from ${prefix}ACT_RU_IDENTITYLINK LINK where LINK.TASK_ID_ = RES.ID_
                and LINK.TYPE_ = 'candidate' and (LINK.USER_ID_ = #{userIdForCandidateAndAssignee, jdbcType=NVARCHAR}
                <if test="candidateGroups != null &amp;&amp; !candidateGroups.empty">
                    or (
                    <foreach item="candidateGroupListItem" index="groupIndex" collection="safeCandidateGroups">
                        <if test="groupIndex &gt; 0">
                        or
                        </if>
                        LINK.GROUP_ID_ IN
                        <foreach item="groupId" index="index" collection="candidateGroupListItem"
                             open="(" separator="," close=")">
                          #{groupId, jdbcType=NVARCHAR}
                        </foreach>
                    </foreach>
                    )
                </if>
                ))))
          </if>
        </when>
      </choose>
      <foreach item="orQueryObject" index="orIndex" collection="orQueryObjects">
        and
        <trim prefix="(" prefixOverrides="OR" suffix=")">
            <if test="orQueryObject.taskId != null">
              RES.ID_ = #{orQueryObject.taskId, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.taskIds != null &amp;&amp; !orQueryObject.taskIds.empty">
                or RES.ID_ IN
                <foreach item="taskId" index="index" collection="orQueryObject.taskIds"
                         open="(" separator="," close=")">
                    #{taskId, jdbcType=NVARCHAR}
                </foreach>
            </if>
            <if test="orQueryObject.name != null">
              or RES.NAME_ = #{orQueryObject.name, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.nameLike != null">
              or RES.NAME_ like #{orQueryObject.nameLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
            </if>
            <if test="orQueryObject.nameLikeIgnoreCase != null">
              or lower(RES.NAME_) like lower(#{orQueryObject.nameLikeIgnoreCase, jdbcType=NVARCHAR})${wildcardEscapeClause}
            </if>
            <if test="orQueryObject.nameList != null &amp;&amp; !orQueryObject.nameList.empty">
              or RES.NAME_ IN
              <foreach item="name" index="index" collection="orQueryObject.nameList"
                      open="(" separator="," close=")">
                #{name, jdbcType=NVARCHAR}
              </foreach>
            </if>
            <if test="orQueryObject.nameListIgnoreCase != null &amp;&amp; !orQueryObject.nameListIgnoreCase.empty">
              or lower(RES.NAME_) IN
              <foreach item="name" index="index" collection="orQueryObject.nameListIgnoreCase"
                       open="(" separator="," close=")">
                #{name, jdbcType=NVARCHAR}
              </foreach>
            </if>
            <if test="orQueryObject.description != null">
              or RES.DESCRIPTION_ = #{orQueryObject.description, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.descriptionLike != null">
              or RES.DESCRIPTION_ like #{orQueryObject.descriptionLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
            </if>
             <if test="orQueryObject.descriptionLikeIgnoreCase != null">
              or lower(RES.DESCRIPTION_) like #{orQueryObject.descriptionLikeIgnoreCase, jdbcType=NVARCHAR}${wildcardEscapeClause}
            </if>
            <if test="orQueryObject.priority != null">
              or RES.PRIORITY_ = #{orQueryObject.priority, jdbcType=INTEGER}
            </if>
            <if test="orQueryObject.minPriority != null">
              or RES.PRIORITY_ &gt;= #{orQueryObject.minPriority, jdbcType=INTEGER}
            </if>
            <if test="orQueryObject.maxPriority != null">
              or RES.PRIORITY_ &lt;= #{orQueryObject.maxPriority, jdbcType=INTEGER}
            </if>
            <if test="orQueryObject.assignee != null">
              or RES.ASSIGNEE_ = #{orQueryObject.assignee, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.assigneeLike != null">
              or RES.ASSIGNEE_ like #{orQueryObject.assigneeLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
            </if>
            <if test="orQueryObject.assigneeLikeIgnoreCase != null">
              or lower(RES.ASSIGNEE_) like #{orQueryObject.assigneeLikeIgnoreCase, jdbcType=NVARCHAR}${wildcardEscapeClause}
            </if>
            <if test="orQueryObject.assigneeIds != null &amp;&amp; !orQueryObject.assigneeIds.empty">
		      or RES.ASSIGNEE_ IN
		      <foreach item="assigneeId" index="index" collection="orQueryObject.assigneeIds"
		               open="(" separator="," close=")">
		        #{assigneeId, jdbcType=NVARCHAR}
		      </foreach>
		    </if>
            <if test="orQueryObject.owner != null">
              or RES.OWNER_ = #{orQueryObject.owner, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.ownerLike != null">
              or RES.OWNER_ like #{orQueryObject.ownerLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
            </if>
            <if test="orQueryObject.ownerLikeIgnoreCase != null">
              or RES.OWNER_ like #{orQueryObject.ownerLikeIgnoreCase, jdbcType=NVARCHAR}${wildcardEscapeClause}
            </if>
            <if test="orQueryObject.unassigned">
              or RES.ASSIGNEE_ IS NULL
            </if>
            <if test="orQueryObject.withAssignee">
              or RES.ASSIGNEE_ IS NOT NULL
      		</if>
            <if test="orQueryObject.noDelegationState">
              or RES.DELEGATION_ IS NULL
            </if>
            <if test="orQueryObject.delegationState != null">
              or RES.DELEGATION_ = #{orQueryObject.delegationStateString, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.processInstanceId != null">
              or RES.PROC_INST_ID_ = #{orQueryObject.processInstanceId, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.processInstanceIds != null &amp;&amp; !orQueryObject.processInstanceIds.empty">
              or RES.PROC_INST_ID_ IN
              <foreach item="processInstanceId" index="index" collection="orQueryObject.processInstanceIds"
                       open="(" separator="," close=")">
                #{processInstanceId, jdbcType=NVARCHAR}
              </foreach>
            </if>
            <if test="orQueryObject.withoutProcessInstanceId">
              or RES.PROC_INST_ID_ IS NULL
            </if>
            <if test="orQueryObject.processInstanceBusinessKey != null || orQueryObject.processInstanceBusinessKeyLike != null || orQueryObject.processInstanceBusinessKeyLikeIgnoreCase != null">
                or exists (
                    select 1
                    from ${prefix}ACT_RU_EXECUTION E
                    where RES.PROC_INST_ID_ = E.ID_ and
                    <trim prefix="(" prefixOverrides="OR" suffix=")">
                        <if test="orQueryObject.processInstanceBusinessKey != null">
                            or E.BUSINESS_KEY_ = #{orQueryObject.processInstanceBusinessKey, jdbcType=NVARCHAR}
                        </if>
                        <if test="orQueryObject.processInstanceBusinessKeyLike != null">
                            or E.BUSINESS_KEY_ like #{orQueryObject.processInstanceBusinessKeyLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
                        </if>
                        <if test="orQueryObject.processInstanceBusinessKeyLikeIgnoreCase != null">
                            or lower(E.BUSINESS_KEY_) like #{orQueryObject.processInstanceBusinessKeyLikeIgnoreCase, jdbcType=NVARCHAR}${wildcardEscapeClause}
                        </if>
                    </trim>
                )
            </if>
            <if test="orQueryObject.executionId != null">
              or RES.EXECUTION_ID_ = #{orQueryObject.executionId, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.scopeId != null">
              or RES.SCOPE_ID_ = #{orQueryObject.scopeId, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.scopeIds != null &amp;&amp; !orQueryObject.scopeIds.empty">
                or (
                <foreach item="scopeIdListItem" index="groupIndex" collection="orQueryObject.safeScopeIds">
                    <if test="groupIndex &gt; 0">
                        or
                    </if>
                    RES.SCOPE_ID_ IN
                    <foreach item="scopeId" index="index" collection="scopeIdListItem" open="(" separator="," close=")">
                        #{scopeId, jdbcType=NVARCHAR}
                    </foreach>
                </foreach>
                )
            </if>
            <if test="orQueryObject.subScopeId != null">
                or RES.SUB_SCOPE_ID_ = #{orQueryObject.subScopeId, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.scopeType != null">
              or RES.SCOPE_TYPE_ = #{orQueryObject.scopeType, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.scopeDefinitionId != null">
              or RES.SCOPE_DEFINITION_ID_ = #{orQueryObject.scopeDefinitionId, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.withoutScopeId">
              or RES.SCOPE_ID_ IS NULL
            </if>
            <if test="orQueryObject.propagatedStageInstanceId != null">
              or RES.PROPAGATED_STAGE_INST_ID_ = #{orQueryObject.propagatedStageInstanceId, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.processInstanceIdWithChildren != null">
              or exists(select ELINK.ID_ from ${prefix}ACT_RU_ENTITYLINK ELINK where ELINK.LINK_TYPE_ = 'child' and
                ELINK.SCOPE_ID_ = #{processInstanceIdWithChildren, jdbcType=NVARCHAR} AND ELINK.SCOPE_TYPE_ = 'bpmn' and
                ELINK.REF_SCOPE_ID_ = RES.ID_ and ELINK.REF_SCOPE_TYPE_ = 'task')
            </if>
            <if test="orQueryObject.caseInstanceIdWithChildren != null">
              or exists(select ELINK.ID_ from ${prefix}ACT_RU_ENTITYLINK ELINK where ELINK.LINK_TYPE_ = 'child' and
                ELINK.SCOPE_ID_ = #{caseInstanceIdWithChildren, jdbcType=VARCHAR} AND ELINK.SCOPE_TYPE_ = 'cmmn' and
                ELINK.REF_SCOPE_ID_ = RES.ID_ and ELINK.REF_SCOPE_TYPE_ = 'task')
            </if>
            <if test="orQueryObject.createTime != null">
              or RES.CREATE_TIME_ = #{orQueryObject.createTime, jdbcType=TIMESTAMP}
            </if>
            <if test="orQueryObject.createTimeBefore != null">
              or RES.CREATE_TIME_ &lt; #{orQueryObject.createTimeBefore, jdbcType=TIMESTAMP}
            </if>
            <if test="orQueryObject.createTimeAfter != null">
              or RES.CREATE_TIME_ &gt; #{orQueryObject.createTimeAfter, jdbcType=TIMESTAMP}
            </if>
            <if test="orQueryObject.key != null">
              or RES.TASK_DEF_KEY_ = #{orQueryObject.key, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.keyLike != null">
              or RES.TASK_DEF_KEY_ like #{orQueryObject.keyLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
            </if>
            <if test="orQueryObject.keys != null and !orQueryObject.keys.empty">
                or RES.TASK_DEF_KEY_ in
                <foreach item="key" index="index" collection="orQueryObject.keys" open="(" separator="," close=")">
                    #{key, jdbcType=NVARCHAR}
                </foreach>
            </if>
            <if test="orQueryObject.processDefinitionId != null">
              or RES.PROC_DEF_ID_ = #{orQueryObject.processDefinitionId, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.taskDefinitionId != null">
              or RES.TASK_DEF_ID_ = #{orQueryObject.taskDefinitionId, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.processDefinitionKey != null || orQueryObject.processDefinitionKeyLike != null || orQueryObject.processDefinitionKeyLikeIgnoreCase != null || orQueryObject.processDefinitionName != null || orQueryObject.processDefinitionNameLike != null || (orQueryObject.processCategoryInList != null &amp;&amp; !orQueryObject.processCategoryInList.empty) || (orQueryObject.processCategoryNotInList != null &amp;&amp; !orQueryObject.processCategoryNotInList.empty) || (orQueryObject.processDefinitionKeys != null &amp;&amp; !orQueryObject.processDefinitionKeys.empty) || orQueryObject.deploymentId != null || (orQueryObject.deploymentIds != null &amp;&amp; !orQueryObject.deploymentIds.empty)">
                or exists (
                    select 1
                    from ${prefix}ACT_RE_PROCDEF D
                    where RES.PROC_DEF_ID_ = D.ID_ and
                    <trim prefix="(" prefixOverrides="OR" suffix=")">
                        <if test="orQueryObject.processDefinitionKey != null">
                            or D.KEY_ = #{orQueryObject.processDefinitionKey, jdbcType=NVARCHAR}
                        </if>
                        <if test="orQueryObject.processDefinitionKeyLike != null">
                            or D.KEY_ like #{orQueryObject.processDefinitionKeyLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
                        </if>
                        <if test="orQueryObject.processDefinitionKeyLikeIgnoreCase != null">
                            or lower(D.KEY_) like #{orQueryObject.processDefinitionKeyLikeIgnoreCase, jdbcType=NVARCHAR}${wildcardEscapeClause}
                        </if>
                        <if test="orQueryObject.processDefinitionKeys != null &amp;&amp; !orQueryObject.processDefinitionKeys.empty">
                            or D.KEY_ in
                            <foreach item="processDefinitionKey" index="index" collection="orQueryObject.processDefinitionKeys" open="(" separator="," close=")">
                                #{processDefinitionKey, jdbcType=NVARCHAR}
                            </foreach>
                        </if>
                        <if test="orQueryObject.processDefinitionName != null">
                            or D.NAME_ = #{orQueryObject.processDefinitionName, jdbcType=NVARCHAR}
                        </if>
                        <if test="orQueryObject.processDefinitionNameLike != null">
                            or D.NAME_ like #{orQueryObject.processDefinitionNameLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
                        </if>
                        <if test="orQueryObject.processCategoryInList != null &amp;&amp; !orQueryObject.processCategoryInList.empty">
                            or D.CATEGORY_ IN
                            <foreach item="processCategory" index="index" collection="orQueryObject.processCategoryInList"
                                     open="(" separator="," close=")">
                                #{processCategory, jdbcType=NVARCHAR}
                            </foreach>
                        </if>
                        <if test="orQueryObject.processCategoryNotInList != null &amp;&amp; !orQueryObject.processCategoryNotInList.empty">
                            or D.CATEGORY_ NOT IN
                            <foreach item="processCategory" index="index" collection="orQueryObject.processCategoryNotInList"
                                     open="(" separator="," close=")">
                                #{processCategory, jdbcType=NVARCHAR}
                            </foreach>
                        </if>
                        <if test="orQueryObject.deploymentId != null">
                            or D.DEPLOYMENT_ID_ = #{orQueryObject.deploymentId, jdbcType=NVARCHAR}
                        </if>
                        <if test="orQueryObject.deploymentIds != null &amp;&amp; !orQueryObject.deploymentIds.empty">
                            or D.DEPLOYMENT_ID_ IN
                            <foreach item="deploymentId" index="index" collection="orQueryObject.deploymentIds"
                                     open="(" separator="," close=")">
                                #{deploymentId, jdbcType=NVARCHAR}
                            </foreach>
                        </if>
                    </trim>
                )
            </if>
            <if test="orQueryObject.caseDefinitionKey != null || orQueryObject.caseDefinitionKeyLike != null || orQueryObject.caseDefinitionKeyLikeIgnoreCase != null || (orQueryObject.caseDefinitionKeys != null &amp;&amp; !orQueryObject.caseDefinitionKeys.empty) || orQueryObject.cmmnDeploymentId != null || (orQueryObject.cmmnDeploymentIds != null &amp;&amp; !orQueryObject.cmmnDeploymentIds.empty)">
                or exists (
                    select 1
                    from ${prefix}ACT_CMMN_CASEDEF CD
                    where RES.SCOPE_DEFINITION_ID_ = CD.ID_ and
                    <trim prefix="(" prefixOverrides="OR" suffix=")">
                        <if test="orQueryObject.caseDefinitionKey != null">
                            or CD.KEY_ = #{orQueryObject.caseDefinitionKey, jdbcType=VARCHAR}
                        </if>
                        <if test="orQueryObject.caseDefinitionKeyLike != null">
                            or CD.KEY_ like #{orQueryObject.caseDefinitionKeyLike, jdbcType=VARCHAR}${wildcardEscapeClause}
                        </if>
                        <if test="orQueryObject.caseDefinitionKeyLikeIgnoreCase != null">
                            or lower(CD.KEY_) like #{orQueryObject.caseDefinitionKeyLikeIgnoreCase, jdbcType=VARCHAR}${wildcardEscapeClause}
                        </if>
                        <if test="orQueryObject.caseDefinitionKeys != null &amp;&amp; !orQueryObject.caseDefinitionKeys.empty">
                            or CD.KEY_ in
                            <foreach item="caseDefinitionKey" index="index" collection="orQueryObject.caseDefinitionKeys" open="(" separator="," close=")">
                                #{caseDefinitionKey, jdbcType=VARCHAR}
                            </foreach>
                        </if>
                        <if test="orQueryObject.cmmnDeploymentId != null">
                            or CD.DEPLOYMENT_ID_ = #{orQueryObject.cmmnDeploymentId, jdbcType=VARCHAR}
                        </if>
                        <if test="orQueryObject.cmmnDeploymentIds != null &amp;&amp; !orQueryObject.cmmnDeploymentIds.empty">
                            or CD.DEPLOYMENT_ID_ IN
                            <foreach item="cmmnDeploymentId" index="index" collection="orQueryObject.cmmnDeploymentIds"
                                     open="(" separator="," close=")">
                                #{cmmnDeploymentId, jdbcType=VARCHAR}
                            </foreach>
                        </if>
                    </trim>
                )
            </if>
            <if test="orQueryObject.dueDate != null">
              or RES.DUE_DATE_ = #{orQueryObject.dueDate, jdbcType=TIMESTAMP}
            </if>
            <if test="orQueryObject.dueBefore != null">
              or (RES.DUE_DATE_ &lt; #{orQueryObject.dueBefore, jdbcType=TIMESTAMP} and RES.DUE_DATE_ is not null)
            </if>
            <if test="orQueryObject.dueAfter != null">
              or (RES.DUE_DATE_ &gt; #{orQueryObject.dueAfter, jdbcType=TIMESTAMP} and RES.DUE_DATE_ is not null)
            </if>
            <if test="orQueryObject.withoutDueDate">
              or RES.DUE_DATE_ is null
            </if>
            <if test="orQueryObject.category != null">
              or RES.CATEGORY_ = #{orQueryObject.category, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.categoryInList != null &amp;&amp; !orQueryObject.categoryInList.empty">
                or RES.CATEGORY_ IN
                <foreach item="category" index="index" collection="orQueryObject.categoryInList"
                         open="(" separator="," close=")">
                    #{category, jdbcType=NVARCHAR}
                </foreach>
            </if>
            <if test="orQueryObject.categoryNotInList != null &amp;&amp; !orQueryObject.categoryNotInList.empty">
                or RES.CATEGORY_ NOT IN
                <foreach item="category" index="index" collection="orQueryObject.categoryNotInList"
                         open="(" separator="," close=")">
                    #{category, jdbcType=NVARCHAR}
                </foreach>
            </if>
            <if test="orQueryObject.withoutCategory">
                or RES.CATEGORY_ IS NULL
            </if>
            <if test="orQueryObject.withFormKey">
              or RES.FORM_KEY_ IS NOT NULL
            </if>
            <if test="orQueryObject.formKey != null">
                or RES.FORM_KEY_ = #{orQueryObject.formKey, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.excludeSubtasks">
              or RES.PARENT_TASK_ID_ IS NULL
            </if>

            <if test="!orQueryObject.bothCandidateAndAssigned &amp;&amp; (orQueryObject.candidateUser != null || orQueryObject.candidateGroups != null)">
              or (
                <if test="!orQueryObject.ignoreAssigneeValue">
                    RES.ASSIGNEE_ is null and
                </if>
                exists(select LINK.ID_ from ${prefix}ACT_RU_IDENTITYLINK LINK where LINK.TYPE_ = 'candidate' and LINK.TASK_ID_ = RES.ID_
                    and
                    (
                    <if test="orQueryObject.candidateUser != null">
                      LINK.USER_ID_ = #{orQueryObject.candidateUser, jdbcType=NVARCHAR}
                    </if>
                    <if test="orQueryObject.candidateUser != null &amp;&amp; orQueryObject.candidateGroups != null &amp;&amp; !orQueryObject.candidateGroups.empty">
                      or
                    </if>
                    <if test="orQueryObject.candidateGroups != null &amp;&amp; !orQueryObject.candidateGroups.empty">
                        (
                        <foreach item="candidateGroupListItem" index="groupIndex" collection="orQueryObject.safeCandidateGroups">
                            <if test="groupIndex &gt; 0">
                            or
                            </if>
                            LINK.GROUP_ID_ IN
                            <foreach item="groupId" index="index" collection="candidateGroupListItem"
                                 open="(" separator="," close=")">
                              #{groupId, jdbcType=NVARCHAR}
                            </foreach>
                        </foreach>
                        )
                    </if>
                    )
                )
              )
            </if>
            <if test="orQueryObject.involvedUser != null">
              or (
                exists(select LINK.ID_ from ${prefix}ACT_RU_IDENTITYLINK LINK where LINK.USER_ID_ = #{orQueryObject.involvedUser, jdbcType=NVARCHAR} and LINK.TASK_ID_ = RES.ID_)
                or RES.ASSIGNEE_ = #{orQueryObject.involvedUser, jdbcType=NVARCHAR}
                or RES.OWNER_ = #{orQueryObject.involvedUser, jdbcType=NVARCHAR}
                )
            </if>
            <if test="orQueryObject.involvedGroups != null">
              or (
                EXISTS(select LINK.ID_ from ${prefix}ACT_RU_IDENTITYLINK LINK where LINK.TASK_ID_ = RES.ID_ and
                    (
                    <foreach item="involvedGroupListItem" index="groupIndex" collection="orQueryObject.safeInvolvedGroups">
                        <if test="groupIndex &gt; 0">
                        or
                        </if>
                        LINK.GROUP_ID_ IN
                        <foreach item="groupId" index="index" collection="involvedGroupListItem"
                              open="(" separator="," close=")">
                          #{groupId, jdbcType=NVARCHAR}
                        </foreach>
                    </foreach>
                    )
                 )
              )
            </if>
            <if test="orQueryObject.parentScopeId != null">
                or EXISTS(select 1 from ${prefix}ACT_RU_ENTITYLINK LINK where
                    LINK.SCOPE_ID_ = #{orQueryObject.parentScopeId, jdbcType=NVARCHAR}
                    and LINK.REF_SCOPE_ID_ = RES.ID_
                    and LINK.HIERARCHY_TYPE_ = 'parent'
                )
            </if>
            <if test="orQueryObject.rootScopeId != null">
                or exists(
                    select 1 from ${prefix}ACT_RU_ENTITYLINK LINK where
                        LINK.REF_SCOPE_ID_ = RES.ID_
                        and LINK.ROOT_SCOPE_ID_ = #{orQueryObject.rootScopeId, jdbcType=NVARCHAR}
                )
            </if>
            <foreach item="var" collection="orQueryObject.queryVariableValues" index="index">
              or
              <trim prefix="(" prefixOverrides="AND" suffix=")">
                <choose>
                    <when test="var.operator.equals('EXISTS')">
                        and EXISTS (
                            select ID_ from ${prefix}ACT_RU_VARIABLE where NAME_ = #{var.name, jdbcType=NVARCHAR}
                        <if test="!var.local">
                            <choose>
                                <when test="var.scopeType == null or var.scopeType == 'bpmn'">
                                    and RES.PROC_INST_ID_ = PROC_INST_ID_
                                </when>
                                <otherwise>
                                    and RES.SCOPE_ID_ = SCOPE_ID_ and SCOPE_TYPE_ = #{var.scopeType, jdbcType=NVARCHAR}
                                </otherwise>
                            </choose>
                            and TASK_ID_ is null
                        </if>
                        <if test="var.local">
                            and RES.ID_ = TASK_ID_
                        </if>
                        )
                    </when>
                    <when test="var.operator.equals('NOT_EXISTS')">
                        and NOT EXISTS (
                            select ID_ from ${prefix}ACT_RU_VARIABLE where NAME_ = #{var.name, jdbcType=NVARCHAR}
                        <if test="!var.local">
                            <choose>
                                <when test="var.scopeType == null or var.scopeType == 'bpmn'">
                                    and RES.PROC_INST_ID_ = PROC_INST_ID_
                                </when>
                                <otherwise>
                                    and RES.SCOPE_ID_ = SCOPE_ID_ and SCOPE_TYPE_ = #{var.scopeType, jdbcType=NVARCHAR}
                                </otherwise>
                            </choose>
                            and TASK_ID_ is null
                        </if>
                        <if test="var.local">
                            and RES.ID_ = TASK_ID_
                        </if>
                        )
                    </when>
                    <otherwise>
                        and exists (
                            select 1
                            from ${prefix}ACT_RU_VARIABLE V
                            <where>
                                <if test="!var.local">
                                    <choose>
                                        <when test="var.scopeType == null or var.scopeType == 'bpmn'">
                                            and RES.PROC_INST_ID_ = V.PROC_INST_ID_
                                        </when>
                                        <otherwise>
                                            and RES.SCOPE_ID_ = V.SCOPE_ID_ and V.SCOPE_TYPE_ = #{var.scopeType, jdbcType=NVARCHAR}
                                        </otherwise>
                                    </choose>
                                    and V.TASK_ID_ is null
                                </if>
                                <if test="var.local">
                                    and RES.ID_ = V.TASK_ID_
                                </if>
                                <if test="var.name != null">
                                    <!-- Match-all variable-names when name is null -->
                                    and V.NAME_= #{var.name, jdbcType=NVARCHAR}
                                </if>
                                <if test="var.name == null">
                                    and V.NAME_ is not null
                                </if>
                                <if test="var.needsTypeCheck()">
                                    and V.TYPE_ = #{var.type, jdbcType=NVARCHAR}
                                </if>
                                <!-- Variable value -->
                                <if test="var.textValue != null &amp;&amp; var.longValue == null &amp;&amp; var.doubleValue == null">
                                    <choose>
                                        <when test="var.operator.equals('EQUALS_IGNORE_CASE') || var.operator.equals('NOT_EQUALS_IGNORE_CASE') || var.operator.equals('LIKE_IGNORE_CASE')">
                                            and (lower(V.TEXT_)
                                        </when>
                                        <otherwise>
                                            and (V.TEXT_
                                        </otherwise>
                                    </choose>
                                    <choose>
                                        <when test="var.operator.equals('LIKE') || var.operator.equals('LIKE_IGNORE_CASE')">LIKE</when>
                                        <otherwise><include refid="executionVariableOperator" /></otherwise>
                                    </choose>
                                    #{var.textValue, jdbcType=NVARCHAR}
                                    <choose>
                                        <when test="var.operator.equals('LIKE') || var.operator.equals('LIKE_IGNORE_CASE')">${wildcardEscapeClause}</when>
                                    </choose>
                                    <if test="var.operator.equals('NOT_EQUALS') || var.operator.equals('NOT_EQUALS_IGNORE_CASE')">
                                        or V.TEXT_ is null
                                    </if>
                                    )
                                </if>
                                <if test="var.textValue2 != null">
                                    and V.TEXT2_
                                    <choose>
                                        <when test="var.operator.equals('LIKE')">LIKE</when>
                                        <otherwise><include refid="executionVariableOperator" /></otherwise>
                                    </choose>
                                    #{var.textValue2, jdbcType=NVARCHAR}
                                    <choose>
                                        <when test="var.operator.equals('LIKE')">${wildcardEscapeClause}</when>
                                    </choose>
                                </if>
                                <if test="var.longValue != null">
                                    and (V.LONG_
                                    <include refid="executionVariableOperator" />
                                    #{var.longValue, jdbcType=BIGINT}
                                    <if test="var.operator.equals('NOT_EQUALS') || var.operator.equals('NOT_EQUALS_IGNORE_CASE')">
                                        or V.LONG_ is null
                                    </if>
                                    )
                                </if>
                                <if test="var.doubleValue != null">
                                    and (V}.DOUBLE_
                                    <include refid="executionVariableOperator" />
                                    #{var.doubleValue, jdbcType=DOUBLE}
                                    <if test="var.operator.equals('NOT_EQUALS') || var.operator.equals('NOT_EQUALS_IGNORE_CASE')">
                                        or V.DOUBLE_ is null
                                    </if>
                                    )
                                </if>
                                <!-- Null variable type -->
                                <if test="var.textValue == null &amp;&amp; var.textValue2 == null &amp;&amp; var.longValue == null &amp;&amp; var.doubleValue == null">
                                    <choose>
                                        <when test="var.operator.equals('NOT_EQUALS')">
                                            and (V.TEXT_ is not null or V.TEXT2_ is not null or V.LONG_ is not null or V.DOUBLE_ is not null or V.BYTEARRAY_ID_ is not null)
                                        </when>
                                        <otherwise>
                                            and V.TEXT_ is null and V.TEXT2_ is null and V.LONG_ is null and V.DOUBLE_ is null and V.BYTEARRAY_ID_ is null
                                        </otherwise>
                                    </choose>
                                </if>
                            </where>
                        )
                    </otherwise>
                </choose>
              </trim>
            </foreach>
            <if test="orQueryObject.suspensionState != null">
              <if test="orQueryObject.suspensionState.stateCode == 1">
                  or RES.SUSPENSION_STATE_ = 1
              </if>
              <if test="orQueryObject.suspensionState.stateCode == 2">
                  or RES.SUSPENSION_STATE_ = 2
              </if>
            </if>
            <if test="orQueryObject.tenantId != null">
              or RES.TENANT_ID_ = #{orQueryObject.tenantId, jdbcType=NVARCHAR}
            </if>
            <if test="orQueryObject.tenantIdLike != null">
              or RES.TENANT_ID_ like #{orQueryObject.tenantIdLike, jdbcType=NVARCHAR}${wildcardEscapeClause}
            </if>
            <if test="orQueryObject.withoutTenantId">
              or (RES.TENANT_ID_ = '' or RES.TENANT_ID_ is null)
            </if>
            <choose>
              <when test="orQueryObject.bothCandidateAndAssigned">
                <!-- if dbIdentityUsed set true in process engine configuration -->
                <if test="orQueryObject.userIdForCandidateAndAssignee != null">
                  <if test="orQueryObject.candidateGroups == null">
                    or (RES.ASSIGNEE_ = #{orQueryObject.userIdForCandidateAndAssignee, jdbcType=NVARCHAR}
                        or (
                        <if test="!orQueryObject.ignoreAssigneeValue">
                            RES.ASSIGNEE_ is null and
                        </if>
                        exists(select LINK.ID_ from ${prefix}ACT_RU_IDENTITYLINK LINK where LINK.TASK_ID_ = RES.ID_
                        and (LINK.USER_ID_ = #{orQueryObject.userIdForCandidateAndAssignee, jdbcType=NVARCHAR}
                        or LINK.GROUP_ID_ IN (select g.GROUP_ID_ from ${prefix}ACT_ID_MEMBERSHIP g where g.USER_ID_ = #{orQueryObject.userIdForCandidateAndAssignee, jdbcType=NVARCHAR} )))))
                  </if>
                </if>
                <!-- if dbIdentityUsed set false in process engine configuration of using custom session factory of GroupIdentityManager -->
                <if test="orQueryObject.candidateGroups != null">
                  or (RES.ASSIGNEE_ = #{orQueryObject.userIdForCandidateAndAssignee, jdbcType=NVARCHAR}
                  or (
                    <if test="!orQueryObject.ignoreAssigneeValue">
                        RES.ASSIGNEE_ is null and
                    </if>
                    exists(select LINK.ID_ from ${prefix}ACT_RU_IDENTITYLINK LINK where LINK.TASK_ID_ = RES.ID_
                    and LINK.TYPE_ = 'candidate' and (LINK.USER_ID_ = #{orQueryObject.userIdForCandidateAndAssignee, jdbcType=NVARCHAR}
                    <if test="orQueryObject.candidateGroups != null &amp;&amp; !orQueryObject.candidateGroups.empty">
                        or (
                        <foreach item="candidateGroupListItem" index="groupIndex" collection="orQueryObject.safeCandidateGroups">
                            <if test="groupIndex &gt; 0">
                            or
                            </if>
                            LINK.GROUP_ID_ IN
                            <foreach item="groupId" index="index" collection="candidateGroupListItem"
                                 open="(" separator="," close=")">
                              #{groupId, jdbcType=NVARCHAR}
                            </foreach>
                        </foreach>
                        )
                    </if>
                  ))))
                </if>
              </when>
            </choose>
          </trim>
        </foreach>
     </where>
  </sql>

  <sql id="executionVariableOperator">
    <choose>
      <when test="var.operator.equals('EQUALS')">=</when>
      <when test="var.operator.equals('EQUALS_IGNORE_CASE')">=</when>
      <when test="var.operator.equals('NOT_EQUALS')">&lt;&gt;</when>
      <when test="var.operator.equals('NOT_EQUALS_IGNORE_CASE')">&lt;&gt;</when>
      <when test="var.operator.equals('GREATER_THAN')">&gt;</when>
      <when test="var.operator.equals('GREATER_THAN_OR_EQUAL')">&gt;=</when>
      <when test="var.operator.equals('LESS_THAN')">&lt;</when>
      <when test="var.operator.equals('LESS_THAN_OR_EQUAL')">&lt;=</when>
   </choose>
  </sql>

  <select id="selectTaskByNativeQuery" parameterType="java.util.Map" resultMap="taskResultMap">
  	<include refid="org.flowable.common.engine.db.selectByNativeQuery"/>
  </select>

  <select id="selectTaskCountByNativeQuery" parameterType="java.util.Map" resultType="long">
     ${sql}
  </select>

</mapper>
